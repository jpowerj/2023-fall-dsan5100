<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jeff Jacobs">
<meta name="dcterms.date" content="2023-12-03">

<title>Bootstrapped Hypothesis Testing Guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script><script src="../../jjcustom.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      DSAN 5100 Section 03 (Thursdays, 12:30-3pm)
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DSAN 5100 Section 03 (Thursdays, 12:30-3pm)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://jfh.georgetown.domains/dsan5100/" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><i class="bi bi-arrow-left" style="margin-right: 4px"></i>Main Course Page</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><i class="bi bi-house pe-1"></i> Section 03 Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w01/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1: Aug 24</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w02/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2: Aug 31</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w03/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3: Sep 7</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w04/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4: Sep 14</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w05/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5: Sep 20</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w06/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 6: Sep 27</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w07/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 7: Oct 5</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w08/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 8: Oct 12</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w09/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 9: Oct 19</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w10/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 10: Oct 26</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w11/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 11: Nov 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w12/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 12: Nov 9</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w13/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 13: Nov 16</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w14/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 14: Nov 30</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../recordings/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture Recordings</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../extra-videos/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extra Videos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../writeups/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extra Writeups</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cheatsheet-math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Cheatsheet</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../final-presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Presentations</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://georgetown.instructure.com/courses/173333" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Canvas Page <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://calendar.app.google/yMnESMtMNPdKEaPz5" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Book Office Hours <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://forms.gle/QBT621Vmcez4Y99r5" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Suggestion Box <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://jjacobs.me/dsps" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Textbook <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-setup-bootstrap-sampling-as-an-extension-of-classical-hypothesis-testing" id="toc-the-setup-bootstrap-sampling-as-an-extension-of-classical-hypothesis-testing" class="nav-link active" data-scroll-target="#the-setup-bootstrap-sampling-as-an-extension-of-classical-hypothesis-testing">(0) The Setup: Bootstrap Sampling as an <em>Extension</em> of Classical Hypothesis Testing</a></li>
  <li><a href="#null-and-alternative-hypotheses" id="toc-null-and-alternative-hypotheses" class="nav-link" data-scroll-target="#null-and-alternative-hypotheses">(1) Null and Alternative Hypotheses</a></li>
  <li><a href="#choosing-an-appropriate-test-statistic" id="toc-choosing-an-appropriate-test-statistic" class="nav-link" data-scroll-target="#choosing-an-appropriate-test-statistic">(2) Choosing an Appropriate Test Statistic</a></li>
  <li><a href="#calculating-and-interpreting-the-observed-test-statistic" id="toc-calculating-and-interpreting-the-observed-test-statistic" class="nav-link" data-scroll-target="#calculating-and-interpreting-the-observed-test-statistic">(3) Calculating and Interpreting the <em>Observed</em> Test Statistic</a></li>
  <li><a href="#generating-counterfactual-synthetic-datasets" id="toc-generating-counterfactual-synthetic-datasets" class="nav-link" data-scroll-target="#generating-counterfactual-synthetic-datasets">(4) Generating <em>Counterfactual</em> (Synthetic) Datasets</a></li>
  <li><a href="#bootstrap-sampling-from-the-counterfactual-datasets" id="toc-bootstrap-sampling-from-the-counterfactual-datasets" class="nav-link" data-scroll-target="#bootstrap-sampling-from-the-counterfactual-datasets">(5) Bootstrap-Sampling from the Counterfactual Datasets</a></li>
  <li><a href="#computing-b-bootstrapped-test-statistics" id="toc-computing-b-bootstrapped-test-statistics" class="nav-link" data-scroll-target="#computing-b-bootstrapped-test-statistics">(6) Computing <span class="math inline">\(B\)</span> Bootstrapped Test Statistics</a></li>
  <li><a href="#interpreting-the-observed-test-statistic-relative-to-the-bootstrapped-test-statistics" id="toc-interpreting-the-observed-test-statistic-relative-to-the-bootstrapped-test-statistics" class="nav-link" data-scroll-target="#interpreting-the-observed-test-statistic-relative-to-the-bootstrapped-test-statistics">(7) Interpreting The <em>Observed</em> Test Statistic Relative To The <em>Bootstrapped</em> Test Statistics</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bootstrapped Hypothesis Testing Guide</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Extra Writeups</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Jeff Jacobs </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="mailto:jj1088@georgetown.edu" target="_blank">jj1088@georgetown.edu</a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 3, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="hidden">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../_globals.r"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I know that it’s coming too late to help you with your final project presentations, but I wanted to provide you all with a quick guide to carrying out hypothesis testing using the <strong>bootstrap method</strong>, where I try my best to omit the technical details so that you can use it as a practical guide in your future data science careers!</p>
<div class="callout callout-style-default callout-note callout-titled" title="@efron_introduction_1994 vs. @james_introduction_2013">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="citation" data-cites="efron_introduction_1994">Efron and Tibshirani (<a href="#ref-efron_introduction_1994" role="doc-biblioref">1994</a>)</span> vs. <span class="citation" data-cites="james_introduction_2013">James et al. (<a href="#ref-james_introduction_2013" role="doc-biblioref">2013</a>)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this guide I draw on <span class="citation" data-cites="efron_introduction_1994">Efron and Tibshirani (<a href="#ref-efron_introduction_1994" role="doc-biblioref">1994</a>)</span> (<a href="https://www.dropbox.com/scl/fi/td2xgv7ocjdjwssu99rv0/Bradley-Efron-Robert-J.-Tibshirani-auth.-An-Introduction-to-the-Bootstrap.pdf?rlkey=hm1xy9n5os7aw4j1friwnzqsn&amp;dl=1" target="_blank">PDF here</a>). This choice may seem weird at first, because the authors of this book went on to author two of the most-used statistical learning textbooks ever, <span class="citation" data-cites="hastie_elements_2013">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie_elements_2013" role="doc-biblioref">2013</a>)</span> and <span class="citation" data-cites="james_introduction_2013">James et al. (<a href="#ref-james_introduction_2013" role="doc-biblioref">2013</a>)</span>, books which we drew on extensively in DSAN 5100!</p>
<p>However, since these books tend to adopt a full-on Bayesian approach, they essentially drop the notion of classical hypothesis testing (though Chapter 13 of <span class="citation" data-cites="james_introduction_2013">James et al. (<a href="#ref-james_introduction_2013" role="doc-biblioref">2013</a>)</span> discusses the specific complexities which arise when testing <strong>multiple</strong> hypotheses using a single dataset). So, instead we’ll be using the older book, since it has a chapter (Chapter 16) which explicitly ties the bootstrap method to classical hypothesis testing!</p>
</div>
</div>
<section id="the-setup-bootstrap-sampling-as-an-extension-of-classical-hypothesis-testing" class="level2">
<h2 class="anchored" data-anchor-id="the-setup-bootstrap-sampling-as-an-extension-of-classical-hypothesis-testing">(0) The Setup: Bootstrap Sampling as an <em>Extension</em> of Classical Hypothesis Testing</h2>
<p>Simplifying the notation from <span class="citation" data-cites="efron_introduction_1994">Efron and Tibshirani (<a href="#ref-efron_introduction_1994" role="doc-biblioref">1994, 224</a>)</span>, we can use <strong>bootstrap sampling</strong> to derive a classical <span class="math inline">\(p\)</span>-value for the difference between two means as follows. Assume we have a sample <span class="math inline">\(\mathbf{X} = (x_1, x_2, \ldots, x_n)\)</span> drawn from a population <span class="math inline">\(\chi\)</span> and a sample <span class="math inline">\(\mathbf{Y} = (y_1, y_2, \ldots, y_m)\)</span> drawn from a population <span class="math inline">\(\psi\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>In code, to see what’s going on as we work through these steps, we load a dataset containing two samples <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>, where we’re <strong>unsure</strong> whether the populations <span class="math inline">\(\chi\)</span> and <span class="math inline">\(\psi\)</span> that they were drawn from actually have equal means:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Populations</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>chi_label <span class="ot">&lt;-</span> <span class="fu">TeX</span>(<span class="st">'$X </span><span class="sc">\\</span><span class="st">sim </span><span class="sc">\\</span><span class="st">chi$'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>psi_label <span class="ot">&lt;-</span> <span class="fu">TeX</span>(<span class="st">'$Y </span><span class="sc">\\</span><span class="st">sim </span><span class="sc">\\</span><span class="st">psi$'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>x_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">val =</span> <span class="fu">runif</span>(N, <span class="dv">0</span>, <span class="dv">10</span>), <span class="at">Population =</span> <span class="st">"chi"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>x_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x_df<span class="sc">$</span>val)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>x_mean_str <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, x_mean)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>xbar_label <span class="ot">&lt;-</span> <span class="fu">TeX</span>(<span class="fu">paste0</span>(<span class="st">'$</span><span class="sc">\\</span><span class="st">bar{X} = '</span>,x_mean_str,<span class="st">'$'</span>))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>y_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">val =</span> <span class="fu">runif</span>(M, <span class="dv">1</span>, <span class="dv">12</span>), <span class="at">Population =</span> <span class="st">"psi"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>y_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(y_df<span class="sc">$</span>val)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>y_mean_str <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, y_mean)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>ybar_label <span class="ot">&lt;-</span> <span class="fu">TeX</span>(<span class="fu">paste0</span>(<span class="st">'$</span><span class="sc">\\</span><span class="st">bar{Y} = '</span>,y_mean_str,<span class="st">'$'</span>))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>data_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(x_df, y_df)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>mean_df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>var, <span class="sc">~</span>var_mean,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x"</span>, x_mean,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"y"</span>, y_mean</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_df, <span class="fu">aes</span>(<span class="at">x=</span>val, <span class="at">fill=</span>Population)) <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">linewidth =</span> g_linewidth) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>mean_df,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xintercept=</span>var_mean, <span class="at">color=</span>var),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> g_linewidth,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dsan_theme</span>() <span class="sc">+</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(cbPalette[<span class="dv">1</span>], cbPalette[<span class="dv">2</span>]),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(chi_label, psi_label)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sample Means"</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(cbPalette[<span class="dv">1</span>], cbPalette[<span class="dv">2</span>]),</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(xbar_label, ybar_label)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Empirical Distributions of X and Y"</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Sampled Value"</span>,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Empirical Probability Density"</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/simulate-pop-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Be sure to keep in mind the whole point of this hypothesis testing procedure: even though we have a <strong>specific</strong> sample <span class="math inline">\(\mathbf{X}\)</span> from <span class="math inline">\(\chi\)</span> and a <strong>specific</strong> sample <span class="math inline">\(\mathbf{Y}\)</span> from <span class="math inline">\(\psi\)</span>, and we can see from this plot that the mean of <span class="math inline">\(\mathbf{Y}\)</span> is higher than the mean of <span class="math inline">\(\mathbf{X}\)</span>, we <strong>cannot</strong> conclude from this that the <strong>population mean</strong> for <span class="math inline">\(\psi\)</span> is greater than the <strong>population mean</strong> for <span class="math inline">\(\chi\)</span>: we may have just gotten “unlucky” and sampled low values from <span class="math inline">\(\chi\)</span> but high values from <span class="math inline">\(\psi\)</span>, when in fact their means are equal. To <strong>test</strong> for this possibility, as opposed to the possibility that the underlying population means really are different, we turn to the <strong>hypothesis testing framework</strong>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</section>
<section id="null-and-alternative-hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="null-and-alternative-hypotheses">(1) Null and Alternative Hypotheses</h2>
<p>First, we derive a null and alternative hypothesis regarding the <strong>populations</strong> from which our two samples were drawn. If we eventually want to test whether or not these two populations have the <strong>same mean</strong>, for example, our null and alternative hypotheses would be</p>
<p><span class="math display">\[
\begin{align*}
H_0: \mu_{\chi} &amp;= \mu_{\psi} \\
H_A: \mu_{\chi} &amp;\neq \mu_{\psi}
\end{align*}
\]</span></p>
</section>
<section id="choosing-an-appropriate-test-statistic" class="level2">
<h2 class="anchored" data-anchor-id="choosing-an-appropriate-test-statistic">(2) Choosing an Appropriate Test Statistic</h2>
<p>Next we remember the fact that, since our hypotheses here are about <strong>population parameters</strong> (in other words, about the <strong>actual</strong> difference in means between the two <strong>populations</strong>), we cannot directly evalute whether they are <strong>true</strong> or <strong>false</strong>, since we don’t have the entire population to look at!<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>However, we <strong>do</strong> have our two <strong>samples</strong> from these populations, <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>, so we try to come up with a way to measure how <strong>likely</strong> the hypotheses are on the basis of the information in these samples.</p>
<p>To this end, we come up with a <strong>test statistic</strong> as a <strong>function</strong> of the information in the samples, which we specifically construct to be <strong>close to 0</strong> when the sample lends support to the <strong>null hypothesis</strong> and <strong>far from 0</strong> when the sample lends support to the <strong>alternative hypothesis</strong>.</p>
<p>As discussed in class, the appropriate classical hypothesis test in this case (since we <strong>do not</strong> know the population standard deviations <span class="math inline">\(\sigma^2_{\mathbf{X}}\)</span> or <span class="math inline">\(\sigma^2_{\mathbf{Y}}\)</span>) is the <strong>two-sample <span class="math inline">\(t\)</span>-test</strong>, which we carry out using the following <strong>test statistic</strong>:</p>
<p><span class="math display">\[
t = \frac{
    \overline{\mathbf{X}} - \overline{\mathbf{Y}}
}{
    \sqrt{
        \frac{s^2_{\mathbf{X}}}{N} + \frac{s^2_{\mathbf{Y}}}{M}
    }
}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\overline{\mathbf{X}}\)</span> is the <strong>sample mean</strong> of <span class="math inline">\(\mathbf{X}\)</span>,</li>
<li><span class="math inline">\(\overline{\mathbf{Y}}\)</span> is the <strong>sample mean</strong> of <span class="math inline">\(\mathbf{Y}\)</span>,</li>
<li><span class="math inline">\(s^2_{\mathbf{X}}\)</span> is the <strong>sample variance</strong> of <span class="math inline">\(\mathbf{X}\)</span>,</li>
<li><span class="math inline">\(s^2_{\mathbf{Y}}\)</span> is the <strong>sample variance</strong> of <span class="math inline">\(\mathbf{Y}\)</span>,</li>
<li><span class="math inline">\(N\)</span> is the sample size of <span class="math inline">\(\mathbf{X}\)</span>, and</li>
<li><span class="math inline">\(M\)</span> is the sample size of <span class="math inline">\(\mathbf{Y}\)</span></li>
</ul>
</section>
<section id="calculating-and-interpreting-the-observed-test-statistic" class="level2">
<h2 class="anchored" data-anchor-id="calculating-and-interpreting-the-observed-test-statistic">(3) Calculating and Interpreting the <em>Observed</em> Test Statistic</h2>
<p>Once we use the equation in the previous section to compute a <span class="math inline">\(t\)</span>-statistic value, on the basis of the <strong>original samples</strong> <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>, we get an <strong>observed test statistic value</strong> <span class="math inline">\(t_{\text{obs}}\)</span>. Let’s compute this test statistic for our two observed samples using R:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute information about sample X</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>x_df <span class="ot">&lt;-</span> data_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(Population <span class="sc">==</span> <span class="st">"chi"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>x_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x_df<span class="sc">$</span>val)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_variance <span class="ot">&lt;-</span> <span class="fu">var</span>(x_df<span class="sc">$</span>val)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>x_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x_df)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute information about sample Y</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>y_df <span class="ot">&lt;-</span> data_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(Population <span class="sc">==</span> <span class="st">"psi"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>y_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(y_df<span class="sc">$</span>val)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>y_variance <span class="ot">&lt;-</span> <span class="fu">var</span>(y_df<span class="sc">$</span>val)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>y_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(y_df)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># And now use this information to compute the test statistic</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>numer <span class="ot">&lt;-</span> x_mean <span class="sc">-</span> y_mean</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>var_term_x <span class="ot">&lt;-</span> x_variance <span class="sc">/</span> x_size</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>var_term_y <span class="ot">&lt;-</span> y_variance <span class="sc">/</span> y_size</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>denom <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_term_x <span class="sc">+</span> var_term_y)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>t_obs <span class="ot">&lt;-</span> numer <span class="sc">/</span> denom</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>t_obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.841297</code></pre>
</div>
</div>
<p>Now, however, we need some <strong>baseline</strong> against which we can <strong>compare</strong> <span class="math inline">\(t_{\text{obs}}\)</span>: in fully-classical hypothesis-testing world, we would just compare the absolute value of our test statistc, <span class="math inline">\(|t_{\text{obs}}|\)</span>, with the Student’s <span class="math inline">\(t\)</span> Distribution, and compute a <span class="math inline">\(p\)</span>-value as the <strong>probability</strong> that we would obtain a value this far away from 0 (or further) if we randomly drew a value from the Student’s <span class="math inline">\(t\)</span> Distribution.</p>
<p>Using R, we could compute this fully-classical <span class="math inline">\(p\)</span>-value as follows:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(t_obs, <span class="at">df =</span> N <span class="sc">+</span> M)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.004958272</code></pre>
</div>
</div>
<p>And since this value is lower than 0.05, for example, in classical world we might conclude that we should <strong>reject</strong> the null hypothesis in this case, and be done with our hypothesis testing.</p>
<p>We might worry, however, about how <strong>robust</strong> this estimate is to peculiarities of the specific samples we took! For example, what if our sample <span class="math inline">\(\mathbf{Y}\)</span> happened to include one or two extreme outliers, which led to its mean being greater than the mean of <span class="math inline">\(\mathbf{X}\)</span>, even if the underlying population means are the same?</p>
<p>To address this concern we turn to the <strong>bootstrap sampling</strong> method, which I think of as a process of seeing how our test statistic <strong>changes</strong> when we <strong>oversample</strong> or <strong>undersample</strong> observations in our original samples. Since bootstrap sampling is performed by drawing datapoints from our original samples <strong>with replacement</strong>, we obtain a large number of slightly-different “versions” of our original samples, where in each “version” (i.e., each bootstrapped sample):</p>
<ul>
<li>Some observations from the original sample <strong>don’t appear at all</strong> (and are thus “undersampled”), while</li>
<li>Some observations from the original sample appear <strong>multiple times</strong> (and are thus “oversampled”).</li>
</ul>
</section>
<section id="generating-counterfactual-synthetic-datasets" class="level2">
<h2 class="anchored" data-anchor-id="generating-counterfactual-synthetic-datasets">(4) Generating <em>Counterfactual</em> (Synthetic) Datasets</h2>
<p>Before we can start under- and oversampling the datapoints, however, to move from the classical to the bootstrapped hypothesis testing approach we’ll construct new, <strong>counterfactual</strong> versions of our samples <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span> which will allow us to <strong>simulate</strong> what our dataset would have looked like <strong>if</strong> the null hypothesis was true. In other words: we want to construct two datasets <span class="math inline">\(\mathbf{X}'\)</span> and <span class="math inline">\(\mathbf{Y}'\)</span> which resemble <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span> as closely as possible <strong>except that</strong> they have the <strong>same mean</strong>. We construct these counterfactual datasets as follows:</p>
<p>Compute the <strong>sample mean</strong> of <span class="math inline">\(\mathbf{X}\)</span> as <span class="math inline">\(\overline{\mathbf{X}}\)</span> and the <strong>sample mean</strong> of <span class="math inline">\(\mathbf{Y}\)</span> as <span class="math inline">\(\overline{\mathbf{Y}}\)</span>, then compute the <strong>overall mean</strong> of <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span> combined as <span class="math inline">\(\overline{\mathbf{Z}}\)</span>. In other words, <span class="math inline">\(\overline{\mathbf{Z}}\)</span> is the mean of the <strong>combined</strong> dataset <span class="math inline">\(\mathbf{Z} = (x_1, x_2, \ldots, x_n, y_1, y_2, \ldots, y_m)\)</span>.</p>
<p>Using these three sample means, we construct a <strong>new</strong> pair of datasets <span class="math inline">\(\mathbf{X'} = (x'_1, x'_2, \ldots, x'_n)\)</span> and <span class="math inline">\(\mathbf{Y}' = (y'_1, y'_2, \ldots, y'_m)\)</span>, our <strong>counterfactual</strong> versions of <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>, where</p>
<p><span class="math display">\[
\begin{align*}
x'_i &amp;= x_i - \overline{\mathbf{X}} + \overline{\mathbf{Z}}, \\
y'_i &amp;= y_i - \overline{\mathbf{Y}} + \overline{\mathbf{Z}}.
\end{align*}
\]</span></p>
<p>In other words, we construct <strong>synthetic</strong> versions of our original datasets where the null hypothesis is true: by subtracting the mean of <span class="math inline">\(\mathbf{X}\)</span> from each point in <span class="math inline">\(\mathbf{X}\)</span>, then adding the overall mean <span class="math inline">\(\overline{Z}\)</span> (and then doing the same for <span class="math inline">\(\mathbf{Y}\)</span>), we have “forced” the synthetic datasets <span class="math inline">\(\mathbf{X}'\)</span> and <span class="math inline">\(\mathbf{Y}'\)</span> to have the same means: specifically, to have mean <span class="math inline">\(\overline{\mathbf{Z}}\)</span>! In code, this looks as follows:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>z_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(data_df<span class="sc">$</span>val)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Here "valp" is short for "value-prime", the transformed</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># values x' and y' from the equations above</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>x_df <span class="ot">&lt;-</span> x_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">valp =</span> val <span class="sc">-</span> x_mean <span class="sc">+</span> z_mean,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>xp_vals <span class="ot">&lt;-</span> x_df<span class="sc">$</span>valp</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>xp_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(xp_vals)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>xp_mean_str <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, xp_mean)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>xpbar_label <span class="ot">&lt;-</span> <span class="fu">TeX</span>(<span class="fu">paste0</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">bar{X'} = "</span>,xp_mean_str,<span class="st">"$"</span>))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>y_df <span class="ot">&lt;-</span> y_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">valp =</span> val <span class="sc">-</span> y_mean <span class="sc">+</span> z_mean</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>yp_vals <span class="ot">&lt;-</span> y_df<span class="sc">$</span>valp</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>yp_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(y_df<span class="sc">$</span>valp)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>yp_mean_str <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, yp_mean)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>ypbar_label <span class="ot">&lt;-</span> <span class="fu">TeX</span>(<span class="fu">paste0</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">bar{Y'} = "</span>,yp_mean_str,<span class="st">"$"</span>))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>synth_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(x_df, y_df)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>synth_mean_df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>var, <span class="sc">~</span>var_mean,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x"</span>, xp_mean,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"y"</span>, yp_mean</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(synth_df, <span class="fu">aes</span>(<span class="at">x=</span>valp, <span class="at">fill=</span>Population)) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">linewidth =</span> g_linewidth) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>synth_mean_df,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xintercept=</span>var_mean, <span class="at">color=</span>var),</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> g_linewidth,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dsan_theme</span>() <span class="sc">+</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(cbPalette[<span class="dv">1</span>], cbPalette[<span class="dv">2</span>]),</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(chi_label, psi_label)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sample Means"</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(cbPalette[<span class="dv">1</span>], cbPalette[<span class="dv">2</span>]),</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(xpbar_label, ypbar_label)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distributions of Synthetic X and Y"</span>,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Sampled Value"</span>,</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Empirical Probability Density"</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/pooled-mean-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The fact that we can now only see a single dashed line is not an error, it’s exactly what we wanted! It shows us that we have successfully created <strong>counterfactual versions</strong> of <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span> which look the same as the originals but are <strong>aligned</strong> to have the same mean (the half-orange, half-blue dashed vertical line in the center of the plot).</p>
</section>
<section id="bootstrap-sampling-from-the-counterfactual-datasets" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap-sampling-from-the-counterfactual-datasets">(5) Bootstrap-Sampling from the Counterfactual Datasets</h2>
<p>Now we perform bootstrap sampling on these <strong>synthetic</strong> datasets <span class="math inline">\(\mathbf{X}'\)</span> and <span class="math inline">\(\mathbf{Y}'\)</span>: for some number of bootstrap samples <span class="math inline">\(B\)</span><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, we create <span class="math inline">\(B\)</span> bootstrapped versions of <span class="math inline">\(\mathbf{X}'\)</span> and <span class="math inline">\(B\)</span> bootstrapped versions of <span class="math inline">\(\mathbf{Y}'\)</span>, giving us <span class="math inline">\(B\)</span> pairs of datasets:</p>
<p><span class="math display">\[
(\widetilde{\mathbf{X}}'_1, \widetilde{\mathbf{Y}}'_1),
(\widetilde{\mathbf{X}}'_2, \widetilde{\mathbf{Y}}'_2),
\ldots,
(\widetilde{\mathbf{X}}'_B, \widetilde{\mathbf{Y}}'_B)
\]</span></p>
<p>As illustrated in the middle column of the following diagram, for example (where here we’ll apply the procedure to obtain <span class="math inline">\(B\)</span> bootstrapped versions of <span class="math inline">\(\mathbf{X}'\)</span> and then <span class="math inline">\(B\)</span> bootstrapped versions of <span class="math inline">\(\mathbf{Y}'\)</span>):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/bootstrap.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>In code this looks like:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>num_bs_samples <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sample_with_replacement <span class="ot">&lt;-</span> <span class="cf">function</span>(sample_vals) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    sample_size <span class="ot">&lt;-</span> <span class="fu">length</span>(sample_vals)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    subsample <span class="ot">&lt;-</span> <span class="fu">sample</span>(sample_vals, sample_size, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(subsample)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>perform_bootstrap <span class="ot">&lt;-</span> <span class="cf">function</span>(sample_vals, B) {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    bootstrapped_datasets <span class="ot">&lt;-</span> <span class="fu">replicate</span>(B, <span class="fu">sample_with_replacement</span>(sample_vals))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(bootstrapped_datasets)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>bootstrap_samples_x <span class="ot">&lt;-</span> <span class="fu">perform_bootstrap</span>(xp_vals, num_bs_samples)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>bootstrap_samples_y <span class="ot">&lt;-</span> <span class="fu">perform_bootstrap</span>(yp_vals, num_bs_samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And this gives us <span class="math inline">\(B = 1000\)</span> bootstrapped versions of our original sample <span class="math inline">\(\mathbf{X}\)</span>, along with <span class="math inline">\(B = 1000\)</span> bootstrapped versions of our original sample <span class="math inline">\(\mathbf{Y}\)</span>, as can be seen by checking the dimensions of the returned values <code>bootstrap_samples_x</code> and <code>bootstrap_samples_y</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(bootstrap_samples_x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  100 1000</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(bootstrap_samples_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  100 1000</code></pre>
</div>
</div>
</section>
<section id="computing-b-bootstrapped-test-statistics" class="level2">
<h2 class="anchored" data-anchor-id="computing-b-bootstrapped-test-statistics">(6) Computing <span class="math inline">\(B\)</span> Bootstrapped Test Statistics</h2>
<p>Now we can use our <span class="math inline">\(B\)</span> pairs of bootstrapped versions of <span class="math inline">\(\mathbf{X}'\)</span> and <span class="math inline">\(\mathbf{Y}'\)</span> to compute <span class="math inline">\(B\)</span> <strong>test statistic values</strong>. In this case, since we’re performing a bootstrapped version of the <strong>two-sample <span class="math inline">\(t\)</span>-test</strong>, we can compute a <span class="math inline">\(t\)</span>-statistic for each pair of bootstrapped datasets. We use the same equation that we used earlier, to compute our <strong>observed</strong> test statistic <span class="math inline">\(t_{\text{obs}}\)</span>, keeping in mind that now we should be getting values centered around 0, since we’re <strong>simulating the world where the null hypothesis is true</strong>!</p>
<p>Copying-and-pasting our above equation for the <span class="math inline">\(t\)</span>-test statistic, but replacing the <strong>observed</strong> versions <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span> with the <strong>counterfactually-generated</strong>, <strong>bootstrapped</strong> versions <span class="math inline">\(\widetilde{\mathbf{X}}'_b\)</span> and <span class="math inline">\(\widetilde{\mathbf{Y}}'_b\)</span> (for <span class="math inline">\(b \in \{1, \ldots, B\}\)</span>), we get an equation <span class="math inline">\(t_b\)</span> representing the test statistic for the <span class="math inline">\(b\)</span>th bootstrapped pair of datasets <span class="math inline">\((\widetilde{\mathbf{X}}'_b, \widetilde{\mathbf{Y}}'_b)\)</span>:</p>
<p><span class="math display">\[
t_b = t\left( \widetilde{\mathbf{X}}'_b, \widetilde{\mathbf{Y}}'_b \right) = \frac{
    \overline{\widetilde{\mathbf{X}}'_b} - \overline{\widetilde{\mathbf{Y}}'_b}
}{
    \sqrt{
        \frac{s^2_{\widetilde{\mathbf{X}}'_b}}{N} + \frac{s^2_{\widetilde{\mathbf{Y}}'_b}}{M}
    }
}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\overline{\widetilde{\mathbf{X}}'_b}\)</span> is the <strong>subsample mean</strong> of <span class="math inline">\(\widetilde{\mathbf{X}}'_b\)</span></li>
<li><span class="math inline">\(\overline{\widetilde{\mathbf{Y}}'_b}\)</span> is the <strong>subsample mean</strong> of <span class="math inline">\(\widetilde{\mathbf{Y}}'_b\)</span>,</li>
<li><span class="math inline">\(s^2_{\widetilde{\mathbf{X}}'_b}\)</span> is the <strong>subsample variance</strong> of <span class="math inline">\(\widetilde{\mathbf{X}}'_b\)</span>,</li>
<li><span class="math inline">\(s^2_{\widetilde{\mathbf{Y}}'_b}\)</span> is the <strong>subsample variance</strong> of <span class="math inline">\(\widetilde{\mathbf{Y}}'_b\)</span>,</li>
<li><span class="math inline">\(N\)</span> is the sample size of <span class="math inline">\(\mathbf{X}\)</span>, and</li>
<li><span class="math inline">\(M\)</span> is the sample size of <span class="math inline">\(\mathbf{Y}\)</span>.</li>
</ul>
<p>In the following code, therefore, we use this equation to generate <span class="math inline">\(B\)</span> test statistics, one for each bootstrapped dataset:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>compute_test_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(xp, yp) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute information about x'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    xp_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(xp)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    xp_variance <span class="ot">&lt;-</span> <span class="fu">var</span>(xp)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    xp_size <span class="ot">&lt;-</span> <span class="fu">length</span>(xp)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute information about y'</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    yp_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(yp)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    yp_variance <span class="ot">&lt;-</span> <span class="fu">var</span>(yp)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    yp_size <span class="ot">&lt;-</span> <span class="fu">length</span>(yp)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And compute the test statistic using this info</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    numer <span class="ot">&lt;-</span> xp_mean <span class="sc">-</span> yp_mean</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    var_term_xp <span class="ot">&lt;-</span> xp_variance <span class="sc">/</span> xp_size</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    var_term_yp <span class="ot">&lt;-</span> yp_variance <span class="sc">/</span> yp_size</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    denom <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_term_xp <span class="sc">+</span> var_term_yp)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    t_b <span class="ot">&lt;-</span> numer <span class="sc">/</span> denom</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(t_b)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For efficiency we could combine this into a single</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># vectorized operation! But, the for loop here makes</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># it clear that we're obtaining B = 1000 test statistic</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># values</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>all_test_stats <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_bs_samples) {</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    cur_xtilde <span class="ot">&lt;-</span> bootstrap_samples_x[,i]</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    cur_ytilde <span class="ot">&lt;-</span> bootstrap_samples_y[,i]</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    cur_test_stat <span class="ot">&lt;-</span> <span class="fu">compute_test_stat</span>(cur_xtilde, cur_ytilde)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    all_test_stats <span class="ot">&lt;-</span> <span class="fu">c</span>(all_test_stats, cur_test_stat)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And we now have a <strong>vector</strong> containing <span class="math inline">\(B = 1000\)</span> bootstrapped test statistics, as can be seen by using the <code>length()</code> function in R:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(all_test_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
</div>
</section>
<section id="interpreting-the-observed-test-statistic-relative-to-the-bootstrapped-test-statistics" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-the-observed-test-statistic-relative-to-the-bootstrapped-test-statistics">(7) Interpreting The <em>Observed</em> Test Statistic Relative To The <em>Bootstrapped</em> Test Statistics</h2>
<p>So, what can we do with 1000 test statistics? Why were we doing all this in the first place? We wanted to see whether our <strong>observed</strong> test statistic value was <strong>robust</strong> to variations in the data! And now we have 1000 versions of the test statistic, each one computed from a bootstrapped version <span class="math inline">\(\mathbf{X}'_b\)</span> and <span class="math inline">\(\mathbf{Y}'_b\)</span> of our original samples <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>. Remember that each of these bootstrapped datasets was constructed by:</p>
<ol type="1">
<li>Creating <strong>counterfactual versions</strong> <span class="math inline">\(\mathbf{X}'\)</span> and <span class="math inline">\(\mathbf{Y}'\)</span> of the original samples <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>, where the counterfactual versions have the same shape as the original samples but are <strong>shifted</strong> to have the <strong>same mean</strong>. Then,</li>
<li>Sampling from these counterfactual versions <strong>with replacement</strong>, so that in each bootstrapped dataset some of the observations from the original samples are <strong>undersampled</strong> and some are <strong>oversampled</strong>.</li>
</ol>
<p>Therefore, the key final step is for us to <strong>compare our observed test statistic with the distribution of these simulated counterfactual test statistics!</strong></p>
<p>To emphasize this, I’ll put it in a fancy textbox 🤓:</p>
<div class="callout callout-style-default callout-note callout-titled" title="Classical vs. Bootstrapped Hypothesis Tests: The Key Difference">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Classical vs.&nbsp;Bootstrapped Hypothesis Tests: The Key Difference
</div>
</div>
<div class="callout-body-container callout-body">
<p>In both classical and bootstrapped hypothesis testing, we compute an <strong>observed</strong> test statistic <span class="math inline">\(t_{\text{obs}}\)</span> from our sample(s).</p>
<p>In classical hypothesis testing we are “done” once we compare <span class="math inline">\(t_{\text{obs}}\)</span> with a <strong>theoretical</strong> distribution (like the Student’s <span class="math inline">\(t\)</span> Distribution), which represents what we “expect” the distribution of sample means from a population of size <span class="math inline">\(N\)</span> to look like.</p>
<p>In our bootstrapped approach here, however, we were a bit more careful: instead of invoking this theoretical assumption, we constructed a “counterfactual world” and then created counterfactual versions of our samples within this world. This gave us a <strong>counterfactual sampling distribution</strong>, which represents our expectation of what our samples <strong>would</strong> look like <strong>if</strong> their underlying population means were equal. This allows us to <strong><em>compare our observed test statistic <span class="math inline">\(t_{\text{obs}}\)</span> with the distribution of these simulated counterfactual test statistics!</em></strong> Put another way, it lets us <strong>interpret</strong> <span class="math inline">\(t_{\text{obs}}\)</span> in the <strong>context</strong> of a world where the null hypothesis is true, so that we can see exactly <strong>how unlikely</strong> <span class="math inline">\(t_{\text{obs}}\)</span> would be in this world.</p>
</div>
</div>
<p>To see this point in practice, we can now plot the <strong>distribution</strong> of our simulated test statistics, representing the <strong>range of test statistics we would expect to see if the null hypothesis was false</strong>, then we can see where our <strong>observed</strong> test statistic <span class="math inline">\(t_{\text{obs}}\)</span> falls on this distribution:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ts_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">t =</span> all_test_stats)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>t_obs_str <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">'%.2f'</span>, t_obs)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>t_obs_label <span class="ot">&lt;-</span> <span class="fu">TeX</span>(<span class="fu">paste0</span>(<span class="st">'$t_{obs} = '</span>,t_obs_str,<span class="st">'$'</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ts_df, <span class="fu">aes</span>(<span class="at">x=</span>t)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">linewidth =</span> g_linewidth, <span class="at">fill=</span>cbPalette[<span class="dv">1</span>], <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> t_obs,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> g_linewidth,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> t_obs <span class="sc">+</span> <span class="fl">0.1</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.38</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> t_obs_label,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">6</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dsan_theme</span>() <span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of 1000 Bootstrapped Test Statistics"</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability Density"</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/plot-test-stats-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see from this plot, for example, that our <strong>observed</strong> test statistic <span class="math inline">\(t_{\text{obs}} \approx -2.84\)</span> is further from 0 than most of our <span class="math inline">\(B = 1000\)</span> bootstrapped test statistics. We can check the exact <strong>proportion</strong> of all test statistics which were this extreme using R:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>more_extreme_df <span class="ot">&lt;-</span> ts_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(t <span class="sc">&gt;=</span> <span class="fu">abs</span>(t_obs))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>proportion_more_extreme <span class="ot">&lt;-</span> <span class="fu">nrow</span>(more_extreme_df) <span class="sc">/</span> <span class="fu">nrow</span>(ts_df)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>proportion_more_extreme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.005</code></pre>
</div>
</div>
<p>And we see that exactly 5 out of our <span class="math inline">\(B = 1000\)</span> bootstrapped test statistics were as extreme (as far from zero) as our observed test statistic <span class="math inline">\(t_{\text{obs}} \approx -2.84\)</span>. <strong>This is precisely the <span class="math inline">\(p\)</span>-value we were looking for!</strong> It tells us that, in the simulated world where our null hypothesis is true, test statistics this extreme are very rare: out of 1000 slightly-different “null worlds”<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, only 5 of these worlds had gaps between the two sample means which were as extreme as the gap we actually observed.</p>
<p>Thus, if we choose a significance level like 5%, or 1%, we <strong>reject</strong> the null hypothesis at these levels, since we interpret our bootstrapped <span class="math inline">\(p\)</span>-value as telling us: <strong>if the null hypothesis was true, we would see a result this extreme 0.5% of the time</strong>, and 0.5% is below the 5% and 1% cutoff values.</p>
<p>However, as a final thought, consider how we’re actually <strong>throwing away</strong> a ton of information by “collapsing” this full bootstrapped test statistic distribution down into a binary 0/1 reject vs.&nbsp;fail-to-reject decision. One of the key principles of <strong>Bayesian</strong> statistics, as opposed to the classical framework, is that we should try our best to <strong>avoid</strong> collapsing full-on probability distributions into single numbers—it’s bad enough that we do it when we compute means, medians, or standard deviations, for example, and the <strong>worst</strong> thing we could <strong>possibly</strong> do in this sense is to collapse an entire distribution down into the binary space <span class="math inline">\(\{0, 1\}\)</span>.</p>
<p>So, your challenge for the rest of your data science career is to resist this temptation to throw away information by collapsing distributions into numbers, and become comfortable with interpreting <strong>distributions themselves</strong> rather than their summaries!</p>
<p>In a sappy way, I think of distributions as telling the “full story” of what’s going on in a dataset, whereas when we ignore these full distributions in favor of summary statistics like means, medians, and standard deviations, we’re basically telling the dataset “Hey, <strong>shut up</strong>, I don’t have time for your full story, and I don’t care… Just give me the gist” 😓</p>
<p>Not only is that mean, it can also lead to a dangerous overconfidence that you “know” your data, when in fact you only know a tiny collapsed “slice” of it. And, as we know from <a href="https://jjacobs.me/dsan5000/463a01339cf0f456ba54a1849df50d1a22c247e3/w06/#the-scariest-dataset-of-all-time" target="_blank">Anscombe’s Quartet</a> (<em>The Scariest Dataset of All Time!</em>), these types of summary statistics can <strong>never</strong> give us a full picture of the data on their own, and can lead us astray, down paths towards fully-incorrect scientific analyses 😭</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-efron_introduction_1994" class="csl-entry" role="listitem">
Efron, Bradley, and R. J. Tibshirani. 1994. <em>An <span>Introduction</span> to the <span>Bootstrap</span></em>. <span>CRC Press</span>.
</div>
<div id="ref-hastie_elements_2013" class="csl-entry" role="listitem">
Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2013. <em>The <span>Elements</span> of <span>Statistical Learning</span>: <span>Data Mining</span>, <span>Inference</span>, and <span>Prediction</span></em>. <span>Springer Science &amp; Business Media</span>.
</div>
<div id="ref-james_introduction_2013" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2013. <em>An <span>Introduction</span> to <span>Statistical Learning</span>: With <span>Applications</span> in <span>R</span></em>. <span>Springer Science &amp; Business Media</span>.
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>In class I noted how it can <strong>really</strong> help you keep in mind the difference between <strong>populations</strong> and <strong>samples</strong> if you use <strong>Greek</strong> letters for population parameters and <strong>Latin</strong> letters for sample statistics. To this end, here I’m using <span class="math inline">\(\chi\)</span> (the Greek letter “chi”) to represent the population corresponding to the sample <span class="math inline">\(\mathbf{X}\)</span>, and <span class="math inline">\(\psi\)</span> (the Greek letter “psi”) to represent the population corresponding to the sample <span class="math inline">\(\mathbf{Y}\)</span>, since the Latin letter <span class="math inline">\(X\)</span> was derived from the Greek <span class="math inline">\(\chi\)</span>, and the Latin letter <span class="math inline">\(Y\)</span> was derived from the Greek <span class="math inline">\(\psi\)</span>!<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Here, since the bootstrap approach <strong>builds on</strong> the classical approach, I want to point out how Steps 1 through 3 are the same as the steps for performing a <strong>classical</strong> hypothesis test, while the steps from 4 onwards are specific to <strong>bootstrapped</strong> hypothesis testing, as they essentially check how “robust” the result from the classical hypothesis test is.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This is crucial to keep in mind as we move to the bootstrapped version, since we’ll be taking <strong>samples of samples</strong>, i.e., <strong>subsamples</strong>, and we’ll have to remember throughout that the original samples <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span> and the bootstrapped subsamples <span class="math inline">\((\widetilde{\mathbf{X}}_b, \widetilde{\mathbf{Y}}_b)\)</span> are both just small pieces of the full population distributions! The “magic” of the bootstrap comes from the fact that it lets us “squeeze” as much information as possible out of a single sample, or pair of samples, when before the bootstrap was invented the only choice was to go out and collect additional samples from the population 🤯<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>There are cases where we have to worry about choosing <span class="math inline">\(B\)</span>, since the bootstrapped version of some algorithms can lead to overfitting for very high values of <span class="math inline">\(B\)</span>, but in this case we don’t need to worry about this: you just want to choose a value as high as possible until the runtime on your computer becomes prohibitively slow.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Remember: slightly-different here means that some of the observations are <strong>oversampled</strong> relative to the observed data, and some of the observations are <strong>undersampled</strong>, since we’re interested in whether our observed test statistic is <strong>robust</strong> to the inclusion or exclusion of individual observations (since, for example, some of these individual observations may be outliers which skew the sample means and sample variances).<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>